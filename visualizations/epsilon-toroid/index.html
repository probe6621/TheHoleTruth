<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Epsilon Toroid Animation | Interactive 5D Visualization â€“ The Hole Truth</title>
    <meta name="description" content="Experience the foundational epsilon toroid visualization with interactive controls, 3-6-9 harmonics, and real-time physics data. See why this isn't a standard n-torus.">
    <meta name="keywords" content="5D toroid animation, epsilon visualization, 3D physics, toroidal energy flow, sacred geometry, 369, Tesla">
    <meta name="author" content="The Hole Truth">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://theholetruth.space/visualizations/epsilon-toroid/">
    <meta property="og:title" content="Epsilon Toroid Animation | Interactive 5D Visualization">
    <meta property="og:description" content="The foundational visualization of the Îµ Framework. See how 5D toroidal geometry differs from standard n-torus mathematics.">
    <meta property="og:image" content="https://theholetruth.space/images/og-toroid.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://theholetruth.space/visualizations/epsilon-toroid/">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>Îµ</text></svg>">
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WMHEMC7S76"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WMHEMC7S76');
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Nunito:wght@300;400;500&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            overflow: hidden; 
            background: #000;
            font-family: 'Nunito', sans-serif;
        }
        canvas { display: block; cursor: grab; }
        canvas:active { cursor: grabbing; }
        
        /* Navigation Header */
        #nav-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 200;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(10,10,18,0.95) 0%, rgba(10,10,18,0.7) 70%, transparent 100%);
        }
        
        #nav-header .logo {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            letter-spacing: 0.15em;
            color: #fff;
            text-decoration: none;
        }
        
        #nav-header .logo span { color: #c4b5fd; }
        
        #nav-header nav {
            display: flex;
            gap: 20px;
        }
        
        #nav-header nav a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 0.8rem;
            letter-spacing: 0.08em;
            transition: color 0.3s ease;
        }
        
        #nav-header nav a:hover, #nav-header nav a.active { color: #c4b5fd; }
        
        /* Info Panel */
        .info-panel {
            position: fixed;
            right: 30px;
            top: 100px;
            width: 320px;
            max-height: 70vh;
            overflow-y: auto;
            background: rgba(20, 20, 40, 0.85);
            border: 1px solid rgba(100, 100, 150, 0.3);
            border-radius: 16px;
            padding: 25px;
            z-index: 100;
            backdrop-filter: blur(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .info-panel.hidden {
            opacity: 0;
            transform: translateX(350px);
            pointer-events: none;
        }
        
        .info-panel h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 15px;
            letter-spacing: 0.1em;
        }
        
        .info-panel h4 {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            color: #c4b5fd;
            margin-top: 20px;
            margin-bottom: 10px;
            padding-top: 15px;
            border-top: 1px solid rgba(196, 181, 253, 0.2);
        }
        
        .info-panel p {
            font-size: 0.9rem;
            color: #b8b8dd;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .science-note {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: rgba(167, 139, 250, 0.8);
            padding: 12px;
            background: rgba(0,0,0,0.4);
            border-left: 2px solid rgba(167, 139, 250, 0.5);
            border-radius: 0 8px 8px 0;
            margin-bottom: 15px;
        }
        
        .distinction-box {
            background: rgba(255, 102, 204, 0.1);
            border: 1px solid rgba(255, 102, 204, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .comparison-table {
            width: 100%;
            font-size: 0.8rem;
            margin: 10px 0;
        }
        
        .comparison-table td {
            padding: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .comparison-table td:first-child {
            color: #ffaa88;
            font-weight: bold;
        }
        
        /* Control Panel */
        .control-panel {
            position: fixed;
            left: 30px;
            top: 100px;
            width: 280px;
            background: rgba(20, 20, 40, 0.85);
            border: 1px solid rgba(100, 100, 150, 0.3);
            border-radius: 16px;
            padding: 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .control-panel.hidden {
            opacity: 0;
            transform: translateX(-310px);
            pointer-events: none;
        }
        
        .control-panel h4 {
            color: #c4b5fd;
            font-size: 0.9rem;
            margin-bottom: 15px;
            letter-spacing: 0.1em;
        }
        
        .control-panel label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #b8b8dd;
            font-size: 0.8rem;
            margin-bottom: 12px;
        }
        
        .control-panel input[type="range"] {
            width: 120px;
            height: 4px;
            background: rgba(167, 139, 250, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        
        .control-panel input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #c4b5fd;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .control-panel input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .control-value {
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            margin-left: 10px;
            min-width: 35px;
            text-align: right;
        }
        
        /* Data Panel */
        .data-panel {
            position: fixed;
            bottom: 40px;
            right: 30px;
            background: rgba(20, 20, 40, 0.85);
            border: 1px solid rgba(100, 100, 150, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
            display: flex;
            gap: 30px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
        }
        
        .data-panel div {
            color: #b8b8dd;
        }
        
        .data-panel span {
            color: #c4b5fd;
            font-weight: bold;
        }
        
        /* Visualization Selector */
        .viz-selector {
            position: fixed;
            left: 30px;
            bottom: 40px;
            background: rgba(20, 20, 40, 0.85);
            border: 1px solid rgba(100, 100, 150, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .viz-selector h4 {
            color: #c4b5fd;
            font-size: 0.8rem;
            margin-bottom: 10px;
            letter-spacing: 0.1em;
        }
        
        .viz-selector a {
            display: inline-block;
            margin-right: 15px;
            color: rgba(255,255,255,0.6);
            text-decoration: none;
            font-size: 0.75rem;
            transition: color 0.3s ease;
        }
        
        .viz-selector a:hover { color: #c4b5fd; }
        
        /* Toggle Buttons */
        .toggle-buttons {
            position: fixed;
            right: 30px;
            top: 70px;
            z-index: 150;
            display: flex;
            gap: 10px;
        }
        
        .toggle-btn {
            background: rgba(167, 139, 250, 0.2);
            border: 1px solid rgba(167, 139, 250, 0.4);
            color: #fff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-btn:hover {
            background: rgba(167, 139, 250, 0.4);
        }
        
        .toggle-btn.active {
            background: rgba(167, 139, 250, 0.6);
        }
        
        /* Annotations */
        .annotation {
            position: absolute;
            color: rgba(255,255,255,0.8);
            font-size: 0.75rem;
            padding: 5px 10px;
            background: rgba(0,0,0,0.6);
            border-radius: 5px;
            pointer-events: none;
            z-index: 50;
            display: none;
        }
        
        .annotation.visible {
            display: block;
        }
        
        #center-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 48px;
            font-weight: bold;
            font-family: 'Georgia', serif;
            text-shadow: 0 0 30px rgba(255,255,255,0.9), 0 0 60px rgba(167, 139, 250, 0.6);
            pointer-events: none;
            z-index: 100;
            opacity: 0.9;
        }
        
        #title {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: white;
            pointer-events: none;
            z-index: 100;
        }
        
        #title h1 {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            font-weight: 400;
            letter-spacing: 8px;
            text-shadow: 0 0 20px rgba(167, 139, 250, 0.6);
        }
        
        #title .subtitle {
            margin-top: 10px;
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            letter-spacing: 3px;
        }
        
        /* Mobile */
        @media (max-width: 768px) {
            .info-panel, .control-panel {
                width: calc(100% - 30px);
                left: 15px;
                right: 15px;
            }
            
            .data-panel, .viz-selector {
                display: none;
            }
        }
        
        /* Sound Control */
        .sound-control {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
        
        .sound-btn {
            background: rgba(167, 139, 250, 0.2);
            border: 1px solid rgba(167, 139, 250, 0.4);
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .sound-btn:hover {
            background: rgba(167, 139, 250, 0.4);
        }
        
        .sound-btn.playing {
            background: rgba(167, 139, 250, 0.6);
        }
        
        /* Custom scrollbar for info panel */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .info-panel::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }
        
        .info-panel::-webkit-scrollbar-thumb {
            background: rgba(167, 139, 250, 0.5);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <div id="nav-header">
        <a href="/" class="logo">THE HOLE <span>TRUTH</span></a>
        <nav>
            <a href="/framework/">Framework</a>
            <a href="/foundation/">Foundation</a>
            <a href="/physics/">Physics</a>
            <a href="/metaphysics/">Metaphysics</a>
            <a href="/visualizations/" class="active">Visualizations</a>
        </nav>
    </div>
    
    <!-- Toggle Buttons -->
    <div class="toggle-buttons">
        <button class="toggle-btn" onclick="togglePanel('info')">INFO</button>
        <button class="toggle-btn" onclick="togglePanel('controls')">CONTROLS</button>
        <button class="toggle-btn" onclick="toggleAnnotations()">LABELS</button>
    </div>
    
    <!-- Info Panel -->
    <div class="info-panel hidden" id="infoPanel">
        <h3>THE EPSILON TOROID</h3>
        <p>You're seeing the foundational shape of reality: a torus with epsilon (Îµ) at its center. Energy flows continuously from center to surface and back.</p>
        
        <div class="science-note">
            Geometry: R = 3 (major), r = 1.2 (minor)<br>
            Pulse frequency: 3-6-9 Hz harmonics<br>
            Îµ center: dimensionless singularity<br>
            Volume: 2Ï€Â²RrÂ² = 70.88 unitsÂ³<br>
            Surface Area: 4Ï€Â²Rr = 142.48 unitsÂ²
        </div>
        
        <h4>THE 5D DISTINCTION</h4>
        <div class="distinction-box">
            <p><strong>This is NOT a standard n-torus!</strong></p>
            
            <table class="comparison-table">
                <tr>
                    <td>Standard n-Torus</td>
                    <td>Îµ-Torus (Our Framework)</td>
                </tr>
                <tr>
                    <td>T^n = SÂ¹Ã—SÂ¹Ã—...</td>
                    <td>11 = (5Ã—2) + Îµ</td>
                </tr>
                <tr>
                    <td>Product of circles</td>
                    <td>5D with two surfaces + center</td>
                </tr>
                <tr>
                    <td>Hole is incidental</td>
                    <td>Hole (Îµ) is essential</td>
                </tr>
                <tr>
                    <td>No organizing center</td>
                    <td>Îµ organizes everything</td>
                </tr>
                <tr>
                    <td>Periodic boundaries</td>
                    <td>Inversion through center</td>
                </tr>
            </table>
            
            <p style="margin-top: 10px; font-size: 0.85em; color: #ffccdd;">
                <strong>The critical difference:</strong> In standard topology, the hole is just empty spaceâ€”an artifact of the embedding. In the Îµ Framework, the hole IS the organizing principle. It's not absence; it's the presence of the inversion point that makes everything else possible.
            </p>
        </div>
        
        <h4>WHY 5 DIMENSIONS?</h4>
        <p>The torus naturally emerges from 5-dimensional geometry:</p>
        <ul style="font-size: 0.85em; color: #b8b8dd; margin-left: 20px;">
            <li>3 spatial dimensions we experience</li>
            <li>1 temporal dimension (time)</li>
            <li>1 dimension that curves through Îµ</li>
            <li>Ã— 2 surfaces (inner/outer, matter/mirror)</li>
            <li>+ Îµ (the dimensionless center)</li>
        </ul>
        <p style="margin-top: 10px;">This gives us: <strong style="color: #88ff88;">11 = (5Ã—2) + 1</strong></p>
        <p style="font-size: 0.85em; color: #aaa;">Exactly M-theory's 11 dimensions!</p>
        
        <h4>THE 3-6-9 PULSE</h4>
        <p>Tesla said "If you knew the magnificence of 3, 6, and 9, you would have a key to the universe." This visualization shows why:</p>
        <div class="science-note">
            3 Hz = Primary rotation (major circle)<br>
            6 Hz = Secondary rotation (minor circle)<br>
            9 Hz = Unity frequency (3+6)<br>
            Îµ = Where all three converge
        </div>
    </div>
    
    <!-- Control Panel -->
    <div class="control-panel hidden" id="controlPanel">
        <h4>INTERACTIVE CONTROLS</h4>
        <label>
            Rotation Speed
            <span>
                <input type="range" min="0" max="1" step="0.1" value="0.3" id="rotSpeed">
                <span class="control-value" id="rotSpeedValue">0.3</span>
            </span>
        </label>
        <label>
            Pulse Intensity
            <span>
                <input type="range" min="0" max="2" step="0.1" value="1" id="pulseInt">
                <span class="control-value" id="pulseIntValue">1.0</span>
            </span>
        </label>
        <label>
            Particle Speed
            <span>
                <input type="range" min="0" max="2" step="0.1" value="1" id="particleSpeed">
                <span class="control-value" id="particleSpeedValue">1.0</span>
            </span>
        </label>
        <label>
            Particle Count
            <span>
                <input type="range" min="500" max="5000" step="500" value="2000" id="particleCount">
                <span class="control-value" id="particleCountValue">2000</span>
            </span>
        </label>
        <label>
            Show Particles
            <input type="checkbox" checked id="showParticles">
        </label>
        <label>
            Show Wireframe
            <input type="checkbox" id="showWireframe">
        </label>
        <label>
            Auto Rotate
            <input type="checkbox" checked id="autoRotate">
        </label>
    </div>
    
    <!-- Data Panel -->
    <div class="data-panel" id="dataPanel">
        <div>Frequency: <span id="freq">3.00</span> Hz</div>
        <div>Phase: <span id="phase">0.00</span> rad</div>
        <div>Entropy Flow: <span id="entropy">1.00</span> Îµ/s</div>
        <div>Frame: <span id="frame">0</span></div>
    </div>
    
    <!-- Visualization Selector -->
    <div class="viz-selector">
        <h4>Related Visualizations:</h4>
        <a href="/quantum-twin-crosssection.html">Quantum Twin</a>
        <a href="/dimensional-unfolding.html">Dimensional Unfolding</a>
        <a href="/nested-hierarchy.html">Nested Hierarchy</a>
        <a href="/cosmic-entropy-engine.html">Entropy Engine</a>
    </div>
    
    <!-- Annotations -->
    <div class="annotation" id="ann1" style="top: 45%; left: 70%;">Major Radius (R=3)</div>
    <div class="annotation" id="ann2" style="top: 30%; left: 50%;">Minor Radius (r=1.2)</div>
    <div class="annotation" id="ann3" style="top: 50%; left: 50%;">Îµ - Inversion Point</div>
    <div class="annotation" id="ann4" style="top: 65%; left: 30%;">5D Toroidal Flow</div>
    
    <!-- Sound Control -->
    <div class="sound-control">
        <button class="sound-btn" onclick="toggleSound()">ðŸ”Š ACTIVATE 3-6-9 HARMONICS</button>
    </div>
    
    <!-- Title and center label -->
    <div id="title">
        <h1>THE EPSILON TOROID</h1>
        <div class="subtitle">5-DIMENSIONAL TOPOLOGY WITH ORGANIZING CENTER</div>
    </div>
    <div id="center-label">Îµ</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // [Keep all the existing JavaScript code exactly the same, just removed the overlay section with âˆ„0]
        // Control variables
        let controls = {
            rotationSpeed: 0.3,
            pulseIntensity: 1.0,
            particleSpeed: 1.0,
            particleCount: 2000,
            showParticles: true,
            showWireframe: false,
            autoRotate: true,
            showAnnotations: false
        };
        
        // Audio context for 3-6-9 harmonics
        let audioContext = null;
        let oscillators = [];
        let isPlaying = false;
        
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Create oscillators for 3, 6, and 9 Hz binaural beats
            const frequencies = [
                { left: 200, right: 203 },  // 3 Hz beat
                { left: 200, right: 206 },  // 6 Hz beat
                { left: 200, right: 209 }   // 9 Hz beat
            ];
            
            frequencies.forEach(freq => {
                const oscillatorLeft = audioContext.createOscillator();
                const oscillatorRight = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                const pannerLeft = audioContext.createStereoPanner();
                const pannerRight = audioContext.createStereoPanner();
                
                oscillatorLeft.frequency.value = freq.left;
                oscillatorRight.frequency.value = freq.right;
                gainNode.gain.value = 0.1;
                pannerLeft.pan.value = -1;
                pannerRight.pan.value = 1;
                
                oscillatorLeft.connect(pannerLeft);
                oscillatorRight.connect(pannerRight);
                pannerLeft.connect(gainNode);
                pannerRight.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillatorLeft.start();
                oscillatorRight.start();
                
                oscillators.push({ left: oscillatorLeft, right: oscillatorRight, gain: gainNode });
            });
        }
        
        function toggleSound() {
            const btn = document.querySelector('.sound-btn');
            if (!audioContext) {
                initAudio();
                isPlaying = true;
                btn.classList.add('playing');
                btn.textContent = 'ðŸ”‡ MUTE 3-6-9 HARMONICS';
            } else {
                if (isPlaying) {
                    oscillators.forEach(osc => osc.gain.gain.value = 0);
                    btn.classList.remove('playing');
                    btn.textContent = 'ðŸ”Š ACTIVATE 3-6-9 HARMONICS';
                } else {
                    oscillators.forEach(osc => osc.gain.gain.value = 0.1);
                    btn.classList.add('playing');
                    btn.textContent = 'ðŸ”‡ MUTE 3-6-9 HARMONICS';
                }
                isPlaying = !isPlaying;
            }
        }
        
        // Toggle functions
        function togglePanel(panel) {
            const infoPanel = document.getElementById('infoPanel');
            const controlPanel = document.getElementById('controlPanel');
            
            if (panel === 'info') {
                infoPanel.classList.toggle('hidden');
                controlPanel.classList.add('hidden');
            } else if (panel === 'controls') {
                controlPanel.classList.toggle('hidden');
                infoPanel.classList.add('hidden');
            }
        }
        
        function toggleAnnotations() {
            controls.showAnnotations = !controls.showAnnotations;
            const annotations = document.querySelectorAll('.annotation');
            annotations.forEach(ann => {
                ann.classList.toggle('visible', controls.showAnnotations);
            });
        }
        
        // Setup control event listeners
        document.getElementById('rotSpeed').addEventListener('input', (e) => {
            controls.rotationSpeed = parseFloat(e.target.value);
            document.getElementById('rotSpeedValue').textContent = e.target.value;
        });
        
        document.getElementById('pulseInt').addEventListener('input', (e) => {
            controls.pulseIntensity = parseFloat(e.target.value);
            document.getElementById('pulseIntValue').textContent = e.target.value;
        });
        
        document.getElementById('particleSpeed').addEventListener('input', (e) => {
            controls.particleSpeed = parseFloat(e.target.value);
            document.getElementById('particleSpeedValue').textContent = e.target.value;
        });
        
        document.getElementById('particleCount').addEventListener('input', (e) => {
            controls.particleCount = parseInt(e.target.value);
            document.getElementById('particleCountValue').textContent = e.target.value;
            recreateParticles();
        });
        
        document.getElementById('showParticles').addEventListener('change', (e) => {
            controls.showParticles = e.target.checked;
            particles.visible = controls.showParticles;
        });
        
        document.getElementById('showWireframe').addEventListener('change', (e) => {
            controls.showWireframe = e.target.checked;
            torusMaterial.wireframe = controls.showWireframe;
        });
        
        document.getElementById('autoRotate').addEventListener('change', (e) => {
            controls.autoRotate = e.target.checked;
        });
        
        // Three.js Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setClearColor(0x000000, 1);
        document.body.appendChild(renderer.domElement);

        // Create holographic torus material with custom shader
        const torusVertexShader = `
            varying vec3 vNormal;
            varying vec3 vPosition;
            varying vec2 vUv;
            uniform float time;
            
            void main() {
                vNormal = normalize(normalMatrix * normal);
                vPosition = position;
                vUv = uv;
                
                vec3 pos = position;
                float wave = sin(pos.x * 3.0 + time) * cos(pos.y * 3.0 + time) * 0.02;
                pos += normal * wave;
                
                gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            }
        `;

        const torusFragmentShader = `
            varying vec3 vNormal;
            varying vec3 vPosition;
            varying vec2 vUv;
            uniform float time;
            uniform vec3 cameraPosition;
            uniform float pulseIntensity;
            
            void main() {
                vec3 viewDirection = normalize(cameraPosition - vPosition);
                float fresnel = pow(1.0 - abs(dot(viewDirection, vNormal)), 3.0);
                
                float hue = vNormal.x * 0.5 + vNormal.y * 0.3 + time * 0.1;
                vec3 color1 = vec3(0.4, 0.6, 1.0);
                vec3 color2 = vec3(0.7, 0.4, 1.0);
                vec3 color3 = vec3(0.3, 0.8, 0.9);
                
                vec3 iridescence = mix(color1, color2, sin(hue * 6.28) * 0.5 + 0.5);
                iridescence = mix(iridescence, color3, cos(hue * 4.0 + time) * 0.5 + 0.5);
                
                float flowU = fract(vUv.x * 12.0 - time * 0.5);
                float flowV = fract(vUv.y * 36.0 + time * 0.3);
                float flow = smoothstep(0.4, 0.5, flowU) * smoothstep(0.6, 0.5, flowU);
                flow += smoothstep(0.4, 0.5, flowV) * smoothstep(0.6, 0.5, flowV) * 0.5;
                
                float pulse3 = sin(time * 3.0) * 0.5 + 0.5;
                float pulse6 = sin(time * 6.0) * 0.5 + 0.5;
                float pulse9 = sin(time * 9.0) * 0.5 + 0.5;
                float pulse = (pulse3 + pulse6 + pulse9) / 3.0 * pulseIntensity;
                
                vec3 finalColor = iridescence * (0.3 + fresnel * 0.7);
                finalColor += vec3(0.6, 0.4, 1.0) * flow * 0.5;
                finalColor += vec3(1.0, 1.0, 1.0) * fresnel * pulse * 0.3;
                
                float alpha = 0.4 + fresnel * 0.5 + flow * 0.2;
                
                gl_FragColor = vec4(finalColor, alpha);
            }
        `;

        // Main torus
        const torusGeometry = new THREE.TorusGeometry(3, 1.2, 64, 128);
        const torusMaterial = new THREE.ShaderMaterial({
            vertexShader: torusVertexShader,
            fragmentShader: torusFragmentShader,
            uniforms: {
                time: { value: 0 },
                cameraPosition: { value: camera.position },
                pulseIntensity: { value: 1.0 }
            },
            transparent: true,
            side: THREE.DoubleSide,
            depthWrite: false,
            wireframe: false
        });
        const torus = new THREE.Mesh(torusGeometry, torusMaterial);
        scene.add(torus);

        // Inner glow torus
        const innerGlowGeometry = new THREE.TorusGeometry(3, 1.15, 32, 64);
        const innerGlowMaterial = new THREE.MeshBasicMaterial({
            color: 0x8b5cf6,
            transparent: true,
            opacity: 0.15,
            side: THREE.DoubleSide
        });
        const innerGlow = new THREE.Mesh(innerGlowGeometry, innerGlowMaterial);
        scene.add(innerGlow);

        // Center lights
        const centerLight = new THREE.PointLight(0xffffff, 2, 10);
        scene.add(centerLight);
        const centerLight2 = new THREE.PointLight(0xa78bfa, 3, 8);
        scene.add(centerLight2);

        // Center glow sphere
        const glowGeometry = new THREE.SphereGeometry(0.3, 32, 32);
        const glowMaterial = new THREE.MeshBasicMaterial({
            color: 0xffffff,
            transparent: true,
            opacity: 0.9
        });
        const glowSphere = new THREE.Mesh(glowGeometry, glowMaterial);
        scene.add(glowSphere);

        const outerGlowGeometry = new THREE.SphereGeometry(0.6, 32, 32);
        const outerGlowMaterial = new THREE.MeshBasicMaterial({
            color: 0xa78bfa,
            transparent: true,
            opacity: 0.3
        });
        const outerGlowSphere = new THREE.Mesh(outerGlowGeometry, outerGlowMaterial);
        scene.add(outerGlowSphere);

        // Particles
        let particles, particleVelocities = [];
        
        function recreateParticles() {
            if (particles) {
                scene.remove(particles);
                particles.geometry.dispose();
                particles.material.dispose();
            }
            
            const particleGeometry = new THREE.BufferGeometry();
            const particlePositions = new Float32Array(controls.particleCount * 3);
            particleVelocities = [];

            for (let i = 0; i < controls.particleCount; i++) {
                const u = Math.random() * Math.PI * 2;
                const v = Math.random() * Math.PI * 2;
                const R = 3, r = 1.2;
                
                particlePositions[i * 3] = (R + r * Math.cos(v)) * Math.cos(u);
                particlePositions[i * 3 + 1] = (R + r * Math.cos(v)) * Math.sin(u);
                particlePositions[i * 3 + 2] = r * Math.sin(v);
                
                particleVelocities.push({
                    u: u, v: v,
                    speedU: 0.005 + Math.random() * 0.01,
                    speedV: 0.002 + Math.random() * 0.005
                });
            }

            particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
            const particleMaterial = new THREE.PointsMaterial({
                color: 0x60a5fa,
                size: 0.03,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });
            particles = new THREE.Points(particleGeometry, particleMaterial);
            particles.visible = controls.showParticles;
            scene.add(particles);
        }
        
        recreateParticles();

        // Ambient light
        scene.add(new THREE.AmbientLight(0x404040, 0.5));

        // Stars
        const starsGeometry = new THREE.BufferGeometry();
        const starsPositions = new Float32Array(3000 * 3);
        for (let i = 0; i < 3000; i++) {
            starsPositions[i * 3] = (Math.random() - 0.5) * 200;
            starsPositions[i * 3 + 1] = (Math.random() - 0.5) * 200;
            starsPositions[i * 3 + 2] = (Math.random() - 0.5) * 200;
        }
        starsGeometry.setAttribute('position', new THREE.BufferAttribute(starsPositions, 3));
        const stars = new THREE.Points(starsGeometry, new THREE.PointsMaterial({ 
            color: 0xffffff, size: 0.1, transparent: true, opacity: 0.6 
        }));
        scene.add(stars);

        // Mouse controls
        let mouseX = 0, mouseY = 0;
        let isMouseDown = false;
        
        document.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                mouseX = (e.clientX / window.innerWidth) * 2 - 1;
                mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
            }
        });
        
        renderer.domElement.addEventListener('mousedown', () => { isMouseDown = true; });
        document.addEventListener('mouseup', () => { isMouseDown = false; });
        
        // Touch controls for mobile
        let touchStart = null;
        renderer.domElement.addEventListener('touchstart', (e) => {
            touchStart = e.touches[0];
        });
        
        renderer.domElement.addEventListener('touchmove', (e) => {
            if (!touchStart) return;
            e.preventDefault();
            const touch = e.touches[0];
            const deltaX = touch.pageX - touchStart.pageX;
            const deltaY = touch.pageY - touchStart.pageY;
            
            mouseX = (deltaX / window.innerWidth) * 2;
            mouseY = -(deltaY / window.innerHeight) * 2;
            
            touchStart = touch;
        });
        
        renderer.domElement.addEventListener('touchend', () => {
            touchStart = null;
        });

        camera.position.z = 8;
        camera.position.y = 2;
        camera.lookAt(0, 0, 0);

        let time = 0;
        let frameCount = 0;
        
        function animate() {
            requestAnimationFrame(animate);
            time += 0.016;
            frameCount++;

            // Update uniforms
            torusMaterial.uniforms.time.value = time;
            torusMaterial.uniforms.cameraPosition.value = camera.position;
            torusMaterial.uniforms.pulseIntensity.value = controls.pulseIntensity;

            // Rotate torus
            if (controls.autoRotate) {
                torus.rotation.x = Math.sin(time * 0.2 * controls.rotationSpeed) * 0.3;
                torus.rotation.y = time * 0.3 * controls.rotationSpeed;
            }
            torus.rotation.x += mouseY * 0.02;
            torus.rotation.y += mouseX * 0.02;
            
            innerGlow.rotation.copy(torus.rotation);

            // 3-6-9 Pulse
            const pulse3 = Math.sin(time * 3) * 0.5 + 0.5;
            const pulse6 = Math.sin(time * 6) * 0.5 + 0.5;
            const pulse9 = Math.sin(time * 9) * 0.5 + 0.5;
            const combinedPulse = (pulse3 + pulse6 * 0.5 + pulse9 * 0.25) / 1.75;
            
            const scaledPulse = combinedPulse * controls.pulseIntensity;
            glowSphere.scale.setScalar(0.8 + scaledPulse * 0.4);
            outerGlowSphere.scale.setScalar(1.2 + scaledPulse * 0.6);
            centerLight.intensity = 1.5 + scaledPulse * 1.5;
            centerLight2.intensity = 2 + scaledPulse * 2;

            // Update particles
            if (particles) {
                const positions = particles.geometry.attributes.position.array;
                const R = 3, r = 1.2;
                for (let i = 0; i < particleVelocities.length; i++) {
                    particleVelocities[i].u += particleVelocities[i].speedU * controls.particleSpeed;
                    particleVelocities[i].v += particleVelocities[i].speedV * controls.particleSpeed;
                    const u = particleVelocities[i].u, v = particleVelocities[i].v;
                    
                    const x = (R + r * Math.cos(v)) * Math.cos(u);
                    const y = (R + r * Math.cos(v)) * Math.sin(u);
                    const z = r * Math.sin(v);
                    
                    const cosX = Math.cos(torus.rotation.x), sinX = Math.sin(torus.rotation.x);
                    const cosY = Math.cos(torus.rotation.y), sinY = Math.sin(torus.rotation.y);
                    const y1 = y * cosX - z * sinX;
                    const z1 = y * sinX + z * cosX;
                    const x1 = x * cosY + z1 * sinY;
                    const z2 = -x * sinY + z1 * cosY;
                    
                    positions[i * 3] = x1;
                    positions[i * 3 + 1] = y1;
                    positions[i * 3 + 2] = z2;
                }
                particles.geometry.attributes.position.needsUpdate = true;
            }

            // Camera movement
            if (controls.autoRotate) {
                camera.position.x = Math.sin(time * 0.1) * 2;
                camera.position.z = 8 + Math.cos(time * 0.1) * 2;
            }
            camera.lookAt(0, 0, 0);

            // Stars rotation
            stars.rotation.y = time * 0.02;

            // Update data panel
            document.getElementById('freq').textContent = (3 + pulse6 * 3 + pulse9 * 3).toFixed(2);
            document.getElementById('phase').textContent = (time % (Math.PI * 2)).toFixed(2);
            document.getElementById('entropy').textContent = (1 + combinedPulse).toFixed(2);
            document.getElementById('frame').textContent = frameCount;

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
